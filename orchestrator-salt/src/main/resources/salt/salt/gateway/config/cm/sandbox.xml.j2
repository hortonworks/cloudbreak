<?xml version="1.0" encoding="UTF-8"?>
<topology>
    <name>sandbox</name>
    <gateway>
        {% if 'SSO_PROVIDER_FROM_UMS' == salt['pillar.get']('gateway:ssotype') -%}

        <provider>
            <role>webappsec</role>
            <name>WebAppSec</name>
            <enabled>true</enabled>
            <param>
                <name>cors.enabled</name>
                <value>true</value>
            </param>
        </provider>
        <provider>
            <role>federation</role>
            <name>SSOCookieProvider</name>
            <enabled>true</enabled>
            <param>
                <name>sso.authentication.provider.url</name>
                <value>https://{{ salt['pillar.get']('gateway:address') }}:8443/{{ salt['pillar.get']('gateway:path') }}/knoxsso/api/v1/websso</value>
            </param>
        </provider>

        {%- else %}

        <provider>
         <role>authentication</role>
         <name>ShiroProvider</name>
         <enabled>true</enabled>
         <param>
            <name>sessionTimeout</name>
            <value>30</value>
         </param>
         <param>
            <name>main.pamRealm</name>
            <value>org.apache.hadoop.gateway.shirorealm.KnoxPamRealm</value>
         </param>
         <param>
            <name>main.pamRealm.service</name>
            <value>login</value>
         </param>
         <param>
            <name>urls./**</name>
            <value>authcBasic</value>
         </param>
        </provider>
        {% endif %}

        <provider>
            <role>identity-assertion</role>
            <name>Default</name>
            <enabled>true</enabled>
        </provider>
    </gateway>
    <service>
        <role>NAMENODE</role>
        <url>hdfs://localhost:8020</url>
    </service>
    <service>
        <role>JOBTRACKER</role>
        <url>rpc://localhost:8050</url>
    </service>
    <service>
        <role>WEBHDFS</role>
        <url>http://localhost:50070/webhdfs</url>
    </service>
    <service>
        <role>WEBHCAT</role>
        <url>http://localhost:50111/templeton</url>
    </service>
    <service>
        <role>OOZIE</role>
        <url>http://localhost:11000/oozie</url>
    </service>
    <service>
        <role>WEBHBASE</role>
        <url>http://localhost:60080</url>
    </service>
    <service>
        <role>HIVE</role>
        <url>http://localhost:10001/cliservice</url>
    </service>
    <service>
        <role>RESOURCEMANAGER</role>
        <url>http://localhost:8088/ws</url>
    </service>
    <service>
        <role>DRUID-COORDINATOR-UI</role>
        <url>http://localhost:8081</url>
    </service>
    <service>
        <role>DRUID-COORDINATOR</role>
        <url>http://localhost:8081</url>
    </service>
    <service>
        <role>DRUID-BROKER</role>
        <url>http://localhost:8082</url>
    </service>
    <service>
        <role>DRUID-ROUTER</role>
        <url>http://localhost:8082</url>
    </service>
    <service>
        <role>DRUID-OVERLORD</role>
        <url>http://localhost:8090</url>
    </service>
    <service>
        <role>DRUID-OVERLORD-UI</role>
        <url>http://localhost:8090</url>
    </service>
    <service>
        <role>CM-API</role>
        <url>http://localhost:7180/api</url>
    </service>
</topology>