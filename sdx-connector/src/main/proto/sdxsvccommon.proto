syntax = "proto3";

package sdxsvccommon;

option java_package = "com.cloudera.thunderhead.service.sdxsvccommon";
option java_outer_classname = "SDXSvcCommonProto";

import "options.proto";

// SDX Cloud Platforms
message CloudPlatform {
  // The Cloud Platform Value
  enum Value {
    // UNSET
    UNSET = 0;
    // AWS Cloud Platform.
    AWS = 1;
    // Local setup
    LOCAL = 99 [(options.EnumValueExtension.hidden) = true];
  }
}

// SDX Connection types.
message ConnectionType {
  // The Connection Type Value
  enum Value {
    // UNSET
    UNSET = 0;
    // AWS PrivateLink Endpoint connection.
    AWS_PRIVATELINK = 1;
  }
}

// The Mapping of regions to a cloud platform
message CloudPlatformRegion {
  // The cloud platform the region belongs to.
  CloudPlatform.Value platform = 1;
  // The region.
  string region = 2;
}

// Generic key-value type
message KeyValuePair {
  // Key
  string key = 1;
  // Value
  string value = 2;
}

// Status of an SDX Instance
message InstanceHighLevelStatus {
  // The Instance Status
  enum Value {
    // UNSET
    UNSET = 0;
    // Instance is being provisioned.
    PROVISIONING = 1;
    // Instance is running
    RUNNING = 2;
    // Instance is unhealthy
    UNHEALTHY = 3;
    // Instance is stopped.
    STOPPED = 4;
    // Instance is being deleted.
    DELETING = 5;
    // Instance is deleted.
    DELETED = 6;
    // Instance is healthy
    HEALTHY = 7;
    // Instance is in an Unknown State
    UNKNOWN = 8;
    // Instance provisioning failed
    FAILED = 9;
  }
}

// Status of an SDX Service
message ServiceStatus {
  // The Service Status
  enum Value {
    // UNSET
    UNSET = 0;
    // Service is being prepared
    PROVISIONING = 1;
    // Service is healthy
    HEALTHY = 2;
    // Service is unhealthy
    UNHEALTHY = 3;
    // Service is upgrading
    UPGRADING = 4;
    // Service is being removed.
    REMOVING = 5;
    // Service is stopped.
    STOPPED = 6;
    // Service is in an Unknown State
    UNKNOWN = 7;
  }
}

// The assignment infor for a service to a RDBMS instance
message DatabaseAssignment {
  // The unique assignment Id.
  string assignmentId = 1;
  // The cloud platform.
  CloudPlatform.Value cloudPlatform = 2;
  // The cloud region the RDS is in.
  string cloudRegion = 3;
  // The database name
  string databaseName = 6;
  // The hostname for RDBMS Endpoint.
  string accessHostname = 7;
  // Port for RDBMS Endpoint.
  string accessPort = 8;
  // TLS enabled.
  bool tlsEnabled = 9;
  // The SDX Instance Id the SDX Service's database instance is attached to.
  string instanceId = 10;
  // The SDX resource the DB is attached to.
  string resourceId = 11;
  // Admin Credentials Vault Path
  string credentialsVaultPath = 12;
}

// The RDBMS instance information
message RdbmsInstance {
  // The name of the RDS.
  string name = 1;
  // The cloud Id of the RDS.
  string cloudId = 2;
  // The cloud platform.
  CloudPlatform.Value cloudPlatform = 3;
  // The cloud region the RDBMS is in
  string cloudRegion = 4;
  // Hostname for RDBMS Endpoint.
  string accessHostname = 5;
  // Port for RDBMS Endpoint.
  string accessPort = 6;
  // Admin Username
  string adminUsername = 7;
  // The Role Arn to be used to connect to the database
  string roleArn = 8;
  // Is the RDBMS instance assignable
  bool assignable = 9;
  // Instance Id - unique Id that will be auto generated by the RM on registration
  string id = 10;
  // Timestamp of registration
  int64 registeredTimestamp = 11 [(options.FieldExtension.datetime) = true];
  // The database assignments on this RDBMS Instance.
  repeated DatabaseAssignment assignments = 12;
  // TLS enabled
  bool tlsEnabled = 13;
}

// Assignment info for a SDX Instance to a Operational Environment
message OperationalEnvironmentAssignment {
  // The unique assignment Id.
  string assignmentId = 1;
  // The CRN of the SDX Instance assigned.
  string instanceCrn = 2;
  // The k8s namespace the instance is assigned to.
  string namespace = 3;
  // The timestamp when the SDX Instance was assigned to the Operational Environment.
  int64 assignedTimestamp = 4 [(options.FieldExtension.datetime) = true];
}

// The SDX Operational Environment
message OperationalEnvironment {
  // The name of the Operational Environment.
  string name = 1;
  // The cloud Id of the Operational Environment.
  string cloudId = 2;
  // The cloud platform.
  CloudPlatform.Value cloudPlatform = 3;
  // The cloud region the Operational Environment is in
  string cloudRegion = 4;
  // Hostname for SDX traffic. NLB fronting the SDX ingress for the cluster.
  string sdxTrafficHostname = 5;
  // Admin traffic access hostname.  NLB fronting the admin ingress for the cluster.
  string adminTrafficHostname = 6;
  // The K8s API Server Endpoint
  string apiServerEndpoint = 7 [(options.FieldExtension.noParamfile) = true];
  // The OpenId Connection provider endpoint
  string openIdProviderEndpoint = 8 [(options.FieldExtension.noParamfile) = true];
  // The CA Cert for the Cluster
  string caCert = 9 [(options.FieldExtension.sensitive) = true];
  // Is the Operational Environment assignable
  bool assignable = 10;
  // Instance Id - unique Id that will be auto generated by the RM on registration
  string id = 11;
  // Timestamp of registration
  int64 registeredTimestamp = 12 [(options.FieldExtension.datetime) = true];
  // The assignments on this Operational Environment
  repeated OperationalEnvironmentAssignment assignments = 13;
  // Timestamp of last update
  int64 updatedTimestamp = 14 [(options.FieldExtension.datetime) = true];
  //The AWS target group for the operational environment.
  string targetGroup = 15;
  // The vault auth method
  string vaultAuthMethod = 16;
  // The OpenId Connection provider cloudId
  string openIdProviderCloudId = 17;
}


// SDX Instance and service history event.
message Event {
  // The event Id.
  string id = 1;
  // The request the event is for.
  string requestId = 2;
  // The status when the event occurred.
  string status = 3;
  // The timestamp the history event occurred at.
  int64 occurredAt = 4 [(options.FieldExtension.datetime) = true];
  // The message associated with the history event.
  string message = 5;
  // The details of the event.
  string details = 6;
}

// Deployment information about an SDX Instance.
message InstanceDeployment {
  // The Operational Environment the SDX Instance runs in.
  string operationalEnvironment = 1;
  // The percent of traffic going to this Operational Environment.
  int32 percentTraffic = 2;
}


// A SDX Service deployment in an SDX Instance.
message Service {
  // The base type of the SDX Service
  string serviceType = 1;
  // The deployed name of the SDX Service.
  string name = 2;
  // The CRN of the SDX Service instance.
  string crn = 3;
  // The namespace the SDX Service runs in.
  string namespace = 4;
  // The version of the SDX Service running.
  string version = 5;
  // The helm deployment name for the SDX Service.
  string helmDeployment = 6;
  // The status of the SDX Service.
  ServiceStatus.Value status = 7;
  // The history events for the SDX Service.
  repeated Event history = 8;
}

// An SDX Instance object.
message Instance {
  // Name of the SDX Instance.
  string name = 1;
  // CRN of the SDX Instance.
  string crn = 2;
  // Status of the SDX Instance.
  InstanceHighLevelStatus.Value status = 3;
  // Cloud platform of the SDX Instance.
  CloudPlatform.Value cloudPlatform = 4;
  // Cloud region the SDX Instance is in.
  string cloudRegion = 5;
  // Description of the SDX Instance.
  string description = 6;
  // Creation time of the SDX Instance.
  int64 created = 7 [(options.FieldExtension.datetime) = true];
  // Hostname to reach the SDX Instance
  string hostname = 8;
  // Port to reach the SDX Instance
  int32 port = 9;
  // The environments the SDX Instance is associated with.
  repeated string environments = 10;
  // Deployment info for SDX Instances
  repeated InstanceDeployment deployments = 11;
  // Event history of the SDX Instance.
  repeated Event history = 12;
}

// An SDX Connection object.
message Connection {
  // The name of the SDX Conneciton
  string name = 1;
  // CRN of the environment.
  string environment = 2;
  // Status of the SDX Connection.
  AwsPrivateLinkState.Value status = 3;
  // The type of SDX Connection.
  ConnectionType.Value type = 4;
  // Cloud platform of the SDX Connection.
  string cloudPlatform = 5;
  // Cloud platforms region for the SDX Connection
  string cloudRegion = 6;
  // The cloud platforms identifier for the SDX Connection.
  string cloudId = 7;
  // IP Addresses for the SDX Connection
  repeated string cloudIpAddresses = 8;
  // Creation time of the SDX Instance.
  int64 created = 9 [(options.FieldExtension.datetime) = true];
  // The history events for the SDX Service.
  repeated Event history = 10;
}

// *********************** Search Messages ***************************

// Search by an SDX Instance.
message SearchByInstance {
  // The CRN of the SDX Instance
  string instance = 1;
}

// Search by an SDX Service.
message SearchByService {
  // The name or CRN of the SDX Instance.
  string instance = 1;
  // The name or CRN of the SDX Service.
  string serviceId = 2;
}

// Search by a Cloud Platform.
message SearchByCloudPlatform {
  // The Cloud Platform to search for
  sdxsvccommon.CloudPlatform.Value cloudPlatform = 1;
}

// Search by a CDP Environment.
message SearchByEnvironment {
  // The name or CRN of the CDP environment.
  string environment = 1;
}

// Search by the Operational Environment.
message SearchByOperationalEnvironment {
  // The name or Id of the Operational Environment.
  string operationalEnvironment = 1;
}

// Search by a Cloud Region.
message SearchByCloudRegion {
  // The cloud region.
  string cloudRegion = 1;
}

// Search by Assignability.
message SearchByAssignability {
  // The assignability.
  bool assignable = 1;
}

// An SDX Shared Indexer instance
message Indexer {
  // The name of the Indexer.
  string name = 1;
  // The cloud Id of the Indexer.
  string cloudId = 2;
  // The cloud platform.
  CloudPlatform.Value cloudPlatform = 3;
  // The cloud region the Indexer is in
  string cloudRegion = 4;
  // Hostname for Indexer Endpoint.
  string accessHostname = 5;
  // Port for Indexer Endpoint.
  string accessPort = 6;
  // TLS enabled
  bool tlsEnabled = 7;
  // The Role Arn to be used to create assignments
  string roleArn = 8;
  // Is the Indexer assignable
  bool assignable = 9;
  // Indexer instance Id - unique Id that will be auto generated by the RM on registration
  string id = 10;
  // Timestamp of registration
  int64 registeredTimestamp = 11 [(options.FieldExtension.datetime) = true];
  // Timestamp of last update
  int64 updatedTimestamp = 12 [(options.FieldExtension.datetime) = true];
  // Assignment to this indexer
  repeated IndexerAssignment assignments = 13;
}

// The assignment info for a service to a Indexer instance
message IndexerAssignment {
  // The unique assignment Id.
  string assignmentId = 1;
  // The cloud platform.
  CloudPlatform.Value cloudPlatform = 2;
  // The cloud region the Indexer is in.
  string cloudRegion = 3;
  // Access Role
  string accessRole = 4;
  // The Indexer Prefix generated from instanceId and serviceId
  string indexPrefix = 5;
  // Hostname for Indexer endpoint.
  string accessHostname = 6;
  // Port for Indexer endpoint.
  string accessPort = 7;
  // TLS enabled
  bool tlsEnabled = 8;
  // The SDX Instance Id the SDX Service's Indexer instance is attached to.
  string instanceId = 9;
  // The SDX Service's Id the Indexer instance is attached to
  string serviceId = 10;
  // Admin Credential Vault Path
  string credentialsVaultPath = 11;
}

// A Storage Root location
message StorageRoot {
  // unique Id that will be auto generated by the RM on registration
  string id = 1;
  // The name of the Storage Root.
  string name = 2;
  // The cloud Id of the Storage Root.
  string cloudId = 3;
  // The cloud platform.
  CloudPlatform.Value cloudPlatform = 4;
  // The cloud region the Storage Root is in.
  string cloudRegion = 5;
  // Timestamp of registration.
  int64 registeredTimestamp = 6 [(options.FieldExtension.datetime) = true];
  // Timestamp of last update.
  int64 updatedTimestamp = 7 [(options.FieldExtension.datetime) = true];
  // Is the Storage Root assignable.
  bool assignable = 8;
  // The Role Arn to be used to create instances.
  string roleArn = 9;
  // The Storage instance assigned to the Storage Root.
  repeated StorageInstance storageInstances = 10;
  // The Permissions Boundary a role attached to this Storage Root has to follow
  string permissionsBoundary = 11;
}

// The instance information for a service to an storage location.
message StorageInstance {
  // The unique instance Id.
  string id = 1;
  // The cloud platform.
  CloudPlatform.Value cloudPlatform = 2;
  // The cloud region the storage instance is in.
  string cloudRegion = 3;
  // The path for the storage.
  string storagePath = 4;
  // The SDX Instance Id the SDX Service's storage instancce is attached to.
  string instanceId = 5;
  // Timestamp of storage instance creation.
  int64 created = 6 [(options.FieldExtension.datetime) = true];
  // Timestamp of storage instance last updated.
  int64 updated = 7 [(options.FieldExtension.datetime) = true];
  // The encryption key Id for the storage.
  string encryptionKeyId = 9;
  // The Storage assigned to the Storage Instance.
  repeated StorageAssignment storageAssignments = 10;
}


// The assignment information for a service to an storage location assignment.
message StorageAssignment {
  // The unique assignment Id.
  string assignmentId = 1;
  // Access Role
  string accessRole = 2;
  // The path for the storage
  string storagePath = 3;
  // The SDX storage resource identifier name.
  string resourceId = 4;
  // Timestamp of storage instance creation.
  int64 created = 5 [(options.FieldExtension.datetime) = true];
  // Timestamp of storage instance last updated.
  int64 updated = 6 [(options.FieldExtension.datetime) = true];
  // The vault credentials path for the storage assignment
  string credentialsVaultPath = 7;
}

// Chart Registry Types
message ChartRegistryAuthType {
  // The Chart Registry Type Value
  enum Value {
    // Unset.
    UNSET = 0;
    // No authentication to the registry is necessary.
    NONE = 1;
    // Standard Username and Password.
    STANDARD = 2;
    // AWS ECR credentials for running IAM Role.
    AWS_ECR = 3;
  }
}

// A Helm Chart Repository
message ChartRepository {
  // End root URL of the chart repository.  This will include schemas like http://, https://, or oci://
  string url = 1 [(options.FieldExtension.required) = true, (options.FieldExtension.noParamfile) = true];
  // The chart repository type.
  ChartRegistryAuthType.Value authType = 2 [(options.FieldExtension.required) = true];
  // The username for the chart repository.
  string username = 3 [(options.FieldExtension.sensitive) = true];
  // The password for the chart repository.
  string password = 4 [(options.FieldExtension.sensitive) = true];
  // Use the registry in insecure mode.
  bool insecure = 5;
}

// Overide of a Chart Version for a Shape
message DeploymentVersionOverride {
  // The name of the chart to use as an override.
  string chartName = 1;
  // The version of the chart to use as an override.
  string version = 2;
  // The deployment name being overriden.
  string deploymentName = 3;
  // The repo where the chart is being used for the override.
  ChartRepository chartRepository = 4;
  // The docker registry where the image is being used for the override.
  string imageRegistry = 5;
}

// An instance of a COD Environment.
message CodEnvironment {
  // unique Id that will be auto generated for the COD Environment on registration
  string id = 1;
  // The name of the COD Environment.
  string name = 2;
  // The cloud platform.
  CloudPlatform.Value cloudPlatform = 3;
  // The cloud region the Load Balancer is in.
  string cloudRegion = 4;
  // The CRN for COD cluster0
  string cluster0Crn = 5;
  // The Zookeeper quorum host for COD cluster0
  string cluster0ZookeeperHost = 6;
  // The CRN for COD cluster1
  string cluster1Crn = 8;
  // The Zookeeper quorum host for COD cluster1
  string cluster1ZookeeperHost = 9;
  // Is the Load Balancer assignable
  bool assignable = 11;
  // The SDX Instances assigned to the Load Balancer
  repeated CodNamespaceAssignment assignments = 12;
  // Timestamp of registration
  int64 registeredTimestamp = 13 [(options.FieldExtension.datetime) = true];
  // Timestamp of last update
  int64 updatedTimestamp = 14 [(options.FieldExtension.datetime) = true];
}

// The assignment info for a Load Balancer
message CodNamespaceAssignment {
  // The unique assignment Id.
  string assignmentId = 1;
  // The cloud platform.
  CloudPlatform.Value cloudPlatform = 2;
  // The cloud region the Indexer is in.
  string cloudRegion = 3;
  // The SDX Instance Id the SDX Service's COD Namespace is attached to.
  string instanceId = 4;
  // The SDX Service's Id COD Namespace is attached to.
  string serviceId = 5;
  // Admin Credentials Vault Path
  string credentialsVaultPath = 6;
  // Timestamp of assginment.
  int64 assignmentTimestamp = 7 [(options.FieldExtension.datetime) = true];
  // Timestamp of last update
  int64 updatedTimestamp = 8 [(options.FieldExtension.datetime) = true];
}

// The assignment info for a service to a kafka topic
message KafkaTopicAssignment {
  // The unique assignment id
  string assignmentId = 1;
  // The Cloud platform.
  sdxsvccommon.CloudPlatform.Value cloudPlatform = 2;
  // the cloud region the kafka topic is in
  string cloudRegion = 3;
  // The topic name
  string topicName = 4;
  // The SDX Instance Id the topic is attached to.
  string instanceId = 5;
  // The SDX resource Id the topic is attached to.
  string resourceId = 6;
  // Admin Credentials Vault Path
  string credentialsVaultPath = 7;
}

// The Kafka instance information
message KafkaInstance {
  // The name of the Kafka Instance
  string name = 1;
  // The cloud id
  string cloudId = 2;
  // The cloud platform
  sdxsvccommon.CloudPlatform.Value cloudPlatform = 3;
  // The cloud region
  string cloudRegion = 4;
  // A list of host:port pairs for establishing the initial connection to the cluster
  string adminEndpoint = 5;
  // Host and ports of Zookeeper servers
  string zookeeperEndpoint = 6;
  // The role ARN to be used to connect
  string roleArn = 7;
  // Is the kafka assignable
  bool assignable = 8;
  // Instance id
  string id = 9;
  // Timestamp of registration
  int64 registeredTimestamp = 10 [(options.FieldExtension.datetime) = true];
  // The topic assignments on this instance
  repeated KafkaTopicAssignment assignments = 11;
  // TLS enabled
  bool tlsEnabled = 12;
}

// AWS Private Link Endpoint state
message AwsPrivateLinkState {
  // AWS Private Link Endpoint state Value
  enum Value {
    // UNSET.
    UNSET = 0;
    // The connection request is pending. This is the initial state if requests are manually accepted.
    PENDINGACCEPTANCE = 1;
    // The service provider accepted the connection request. This is the initial state if requests are automatically accepted. The VPC endpoint returns to this state if the service consumer modifies the VPC endpoint.
    PENDING = 2;
    // The VPC endpoint is available for use.
    AVAILABLE = 3;
    // The service provider rejected the connection request. The service provider can also reject a connection after it is available for use.
    REJECTED = 4;
    // The connection request expired.
    EXPIRED = 5;
    // The VPC endpoint could not be made available.
    FAILED = 6;
    // The service consumer deleted the VPC endpoint and deletion is in progress.
    DELETING = 7;
    // The VPC endpoint is deleted.
    DELETED = 8;
    // unknown.
    UNKNOWN = 9;
  }
}

// An SDX Service object.
message SDXServices {
  // service name.
  string serviceName = 1;
  // service URL.
  string serviceUrl = 2;
  // application name.
  string applicationName = 3;
}

// A feature flag.
message FeatureFlag {
  // The name of the feature flag.
  string name = 1;
  // Is the feature flag active.
  bool active = 2;
}
